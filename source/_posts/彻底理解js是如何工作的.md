---
title: å½»åº•ç†è§£jsæ˜¯å¦‚ä½•å·¥ä½œçš„
date: 2018-11-17 21:23:40
categories:
  - js
---

æ›¾ç» ä½ ä¸€å®šé‡åˆ°è¿‡ç±»ä¼¼è¿™æ ·å„¿çš„é¢˜ç›®

```
console.log('script start')

setTimeout(function() {
    console.log('timer over')
}, 0)

Promise.resolve().then(function() {
    console.log('promise1')
}).then(function() {
    console.log('promise2')
})
console.log('script end')

è¾“å‡ºç»“æœï¼š
script start
script end
promise1
promise2

```
å¦‚æœä½ å¾ˆè½»æ¾çš„ç­”å¯¹å¹¶ä¸”èƒ½è¯´å‡ºåŸç† é‚£ä¹ˆæ­å–œä½ ï¼Œå€˜è‹¥æœ‰äº›ç–‘é—®ï¼Œé‚£ä¹ˆè¯»å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ ä¸€å®šä¼šå½»åº•ææ‡‚å®ƒçš„è¿è¡ŒåŸç†ã€‚

<!-- more -->

### é¦–å…ˆ  å…ˆäº†è§£å‡ ä¸ªæ¦‚å¿µ

> JavaScriptå¼•æ“

jså¼•æ“æ˜¯æ‰§è¡Œjsçš„ç¨‹åºæˆ–è€…è§£é‡Šå™¨ æˆ‘ä»¬å¸¸è¯´çš„V8å¼•æ“å°±æ˜¯ä¸€ç§jså¼•æ“çš„å®ç°ï¼Œå…¶ä»–çš„è¿˜æœ‰åŸºäº`java`å¼€å‘çš„`Rhin` `Nashorn`ç­‰

V8å¼•æ“ ä½¿ç”¨åœ¨chrome å’Œnodeä¸­ï¼Œå®ƒç”±ä¸¤éƒ¨åˆ†ç»„æˆ

* å†…å­˜å † ï¼šè¿™æ˜¯å†…å­˜åˆ†é…å‘ç”Ÿçš„åœ°æ–¹
* è°ƒç”¨æ ˆï¼š è¿™æ˜¯ä½ çš„ä»£ç æ‰§è¡Œæ—¶çš„åœ°æ–¹

-------

> JSçš„ç‰¹æ€§

<font color=red>å•çº¿ç¨‹ å¼‚æ­¥ éé˜»å¡</font>

**jsçš„å•çº¿ç¨‹**
ç”±äºjsçš„å•çº¿ç¨‹

```
console.log('script start')
console.log('do something...')
console.log('script end')

// script start
// do something...
// script end

```
å¾ˆå¥½ç†è§£

é‚£å†æ¥çœ‹

```
console.log('1')

console.log('2')

setTimeout(() => {
  console.log('3')
}, 1000)

// ç‚¹å‡»é¡µé¢
console.log('4')

console.log('5')
```
é‚£ä¹ˆå®ƒçš„è¾“å‡ºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ åº”è¯¥æ˜¯`1ï¼Œ2ï¼Œ4ï¼Œ5ï¼Œ3 `ï¼Ÿ è€Œä¸æ˜¯` 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5 `ï¼Œjsä¸æ˜¯ä¸€è¡Œä¸€è¡Œä»ä¸Šåˆ°ä¸‹æ‰§è¡Œçš„å— ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Ÿ

**è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è¯´çš„é—®é¢˜**

ä¸ºä»€ä¹ˆä¸èƒ½åŒæ­¥æ‰§è¡Œï¼Ÿ

å¦‚æœä¸€ä¸ªä»»åŠ¡çš„å¤„ç†è€—æ—¶ï¼ˆæˆ–è€…æ˜¯ç­‰å¾…ï¼‰å¾ˆä¹…çš„è¯ï¼Œå¦‚ï¼šç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ã€ç­‰å¾…é¼ æ ‡ç‚¹å‡»ç­‰ï¼Œåé¢çš„ä»»åŠ¡ä¹Ÿå°±ä¼šè¢«é˜»å¡,å¯èƒ½ä¼šå‡ºç°ç™½å±çš„æƒ…å†µ ç”¨æˆ·ä½“éªŒæå…¶ä¸å‹å¥½

æ‰€å¹¸çš„æ˜¯ æµè§ˆå™¨ç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„`webapi`

å¦‚ä½•ä¼˜åŒ–ï¼Ÿ

jsçš„å•çº¿ç¨‹æŒ‡çš„æ˜¯æµè§ˆå™¨ä¸­è´Ÿè´£è§£é‡Šå’Œæ‰§è¡Œjsä»£ç çš„åªæœ‰ä¸€ä¸ªçº¿ç¨‹ -jså¼•æ“çº¿ç¨‹ ä½†æ˜¯æµè§ˆå™¨çš„æ¸²æŸ“è¿›ç¨‹æ˜¯æä¾›å¤šä¸ªçº¿ç¨‹çš„ï¼Œé‡åˆ°å®šæ—¶å™¨ Domäº‹ä»¶æˆ–è€…æ˜¯ç½‘ç»œè¯·æ±‚çš„ä»»åŠ¡çš„æ—¶å€™ jså¼•æ“ä¼šå°†ä»–ä»¬äº¤ç»™webapi ä¹Ÿå°±æ˜¯æµè§ˆå™¨æä¾›çš„ç›¸åº”çº¿ç¨‹å»å¤„ç† è€Œjså¼•æ“çº¿ç¨‹ç»§ç»­å»å¤„ç†åé¢çš„ä»»åŠ¡ è¿™æ ·å„¿å®ç°äº†**å¼‚æ­¥éé˜»å¡**
ä»¥ä¸‹æ˜¯æ—¥å¸¸çº¿ç¨‹ï¼š

* jså¼•æ“çº¿ç¨‹
* äº‹ä»¶è§¦å‘çº¿ç¨‹
* å®šæ—¶å™¨è§¦å‘çº¿ç¨‹
* å¼‚æ­¥HTTPè¯·æ±‚çº¿ç¨‹
* GUIæ¸²æŸ“çº¿ç¨‹

å›¾ç¤ºçš„è¯ å¤§æ¦‚é•¿ä¸‹é¢è¿™æ ·å„¿
![jsworke](/images/jsWorker/jsworker.jpg)
æ‰€ä»¥ è¿™é‡Œçš„ å›¾ä¾‹ä¸­çš„`setTimeout`ä¼šè¢«åˆ†é…åˆ°å®šæ—¶å™¨è§¦å‘çº¿ç¨‹å»ç»´æŠ¤ å»å®šæ—¶ï¼Œæ—¶é—´ä¸€åˆ° è¿˜æ˜¯ä¼šæŠŠå®ƒçš„å›è°ƒå¡åˆ°`æ¶ˆæ¯é˜Ÿåˆ—`ç­‰å¾…

é‚£ä¹ˆ åˆ°è¿™é‡Œ åˆå¼•å‡ºäº†ä¸¤ä¸ªé—®é¢˜
1.ä»€ä¹ˆå«æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿ
2.jså¼•æ“ä»€ä¹ˆæ—¶å€™å¤„ç†è¿™ä¸ªå®šæ—¶å™¨ æ€ä¹ˆå¤„ç†ï¼Ÿ

JavaScript é€šè¿‡äº‹ä»¶å¾ªç¯ï¼ˆ event loopï¼‰çš„æœºåˆ¶æ¥è§£å†³è¿™äº›é—®é¢˜
çŒœå¯¹äº†å—ï¼Ÿ
äº‹ä»¶å¾ªç¯ æœºåˆ¶å’Œ æ¶ˆæ¯é˜Ÿåˆ— çš„ç»´æŠ¤æ˜¯ç”±**äº‹ä»¶è§¦å‘çº¿ç¨‹**ï¼ˆæµè§ˆå™¨æ¸²æŸ“å¼•æ“webapiä¹‹ä¸€ï¼‰æ§åˆ¶çš„

JSå¼•æ“çº¿ç¨‹ ä¼šç»´æŠ¤ä¸€ä¸ª æ‰§è¡Œæ ˆ

1. åŒæ­¥å’Œå¼‚æ­¥ä»»åŠ¡è¿›å…¥ä¸åŒçš„æ‰§è¡Œåœºæ‰€ åŒæ­¥çš„è¿›å…¥**ä¸»çº¿ç¨‹** å¼‚æ­¥çš„è¿›å…¥Event Tableå¹¶æ³¨å†Œå‡½æ•°
2. å½“æŒ‡å®šçš„äº‹æƒ…å®Œæˆæ—¶ Event Tableä¼šå°†è¿™ä¸ªå‡½æ•°ç§»å…¥**Event Queue**
3. ä¸»çº¿ç¨‹å†…çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¸ºç©ºï¼Œä¼šå»**Event Queue**è¯»å–å¯¹åº”çš„å‡½æ•°ï¼Œè¿›å…¥ä¸»çº¿ç¨‹æ‰§è¡Œ
4. ä¸Šè¿°è¿‡ç¨‹ä¼šä¸æ–­é‡å¤ï¼Œä¹Ÿå°±æ˜¯å¸¸è¯´çš„**Event Loop**(äº‹ä»¶å¾ªç¯)ã€‚

è¨€è¯­å¤ªè¿‡è‹ç™½ ä¸¾ä¸ªğŸŒ°ï½


![jswork2](/images/jsWorker/jswork2.jpg)

æ‰€ä»¥ è¿™ä¸ªæ—¶å€™æ¥çœ‹
setTimeoutå¼‚æ­¥å‡½æ•°å¯¹åº”çš„å›è°ƒå‡½æ•°( () => {} )ä¼šåœ¨æ‰§è¡Œæ ˆä¸ºç©ºï¼Œä¸»ä»£ç å—æ‰§è¡Œå®Œäº†åæ‰ä¼šæ‰§è¡Œ

ç»“æœå°±ä¸æ„å¤–äº†å§

é‚£ä¹ˆ åƒè¿™æ ·

```
setTimeout(() => {
  console.log('timer')
}, 0)
```
0å»¶æ—¶çš„æƒ…å†µæ˜¯å•¥æ„æ€å‘¢
åªæ˜¯ timerçš„å›è°ƒå‡½æ•°ä¼šç«‹å³åŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—è€Œå·²ï¼Œå›è°ƒçš„æ‰§è¡Œè¿˜æ˜¯å¾—ç­‰æ‰§è¡Œæ ˆä¸ºç©ºï¼ˆJSå¼•æ“çº¿ç¨‹ç©ºé—²ï¼‰æ—¶æ‰§è¡Œã€‚

è¿˜æ²¡å®Œï½ï½

ES5ä¸­ä»¥ä¸Šæ ‡å‡†å°±å¤Ÿç”¨äº† ä½†æ˜¯ES6ä¸­æ–°å‡ºäº†ä¸€äº›API å¼•å‡ºäº†ä¸€äº›æ–°æ¦‚å¿µ

> å®ä»»åŠ¡ä¸å¾®ä»»åŠ¡

å…ˆæ¥çœ‹ä¸€æ®µä»£ç  ä½ èƒ½ç«‹åˆ»è¯´å‡ºå®ƒçš„æ‰§è¡Œç»“æœå—

```
console.log('script start')

setTimeout(function() {
    console.log('timer over')
}, 0)

Promise.resolve().then(function() {
    console.log('promise1')
}).then(function() {
    console.log('promise2')
})

console.log('script end')

// script start
// script end
// promise1
// promise2
// timer over
```
Whatï¼Ÿ timer over ä¼šåœ¨ promise1 promise2 ä¹‹åæ‰§è¡Œï¼Ÿ

å¥½çš„ ä¸è¦ç€æ€¥ å¾€ä¸‹çœ‹ğŸ‘‡
æ‰€æœ‰ä»»åŠ¡åˆ†ä¸º `å®ä»»åŠ¡` å’Œ `å¾®ä»»åŠ¡`

* å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ï¼šä¸»ä»£ç å—ã€setTimeoutã€setIntervalç­‰ï¼ˆå¯ä»¥çœ‹åˆ°ï¼Œäº‹ä»¶é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªäº‹ä»¶éƒ½æ˜¯ä¸€ä¸ª macrotaskï¼Œç°åœ¨ç§°ä¹‹ä¸ºå®ä»»åŠ¡é˜Ÿåˆ—
* å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ï¼šPromiseã€process.nextTickç­‰ åœ¨microtaskä¸­ process.nextTick ä¼˜å…ˆçº§é«˜äº Promise

jsçš„æ‰§è¡Œè§„åˆ™ï¼š

1. æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼ˆæ ˆä¸­æ²¡æœ‰å°±ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰
2. æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¾®ä»»åŠ¡ï¼Œå°±å°†å®ƒæ·»åŠ åˆ°å¾®ä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­
3. å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç«‹å³æ‰§è¡Œå½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å¾®ä»»åŠ¡ï¼ˆä¾æ¬¡æ‰§è¡Œï¼‰
4. å½“å‰å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ£€æŸ¥æ¸²æŸ“ï¼Œç„¶åGUIçº¿ç¨‹æ¥ç®¡æ¸²æŸ“
5. æ¸²æŸ“å®Œæ¯•åï¼ŒJSå¼•æ“çº¿ç¨‹ç»§ç»­ï¼Œå¼€å§‹ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆä»å®ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ï¼‰

æ‰€ä»¥ promise1 ä¸ promise1å±äºå¾®ä»»åŠ¡ ä¼šåœ¨ç¬¬ä¸€ä¸ªå®ä»»åŠ¡ç»“æŸä¹‹åç«‹å³æ‰§è¡Œ è€ŒsetTimeoutå³ä½¿å»¶æ—¶ä¸º0 ä¹Ÿæ˜¯è¦ç­‰åˆ°ä¸‹ä¸ªäº‹ä»¶å¾ªç¯å»æ‰§è¡Œçš„ğŸ˜Š

å†ç®€å•ç‚¹çš„è¯ é‚£å°±

macro-taské˜Ÿåˆ—åŒ…å«ä»»åŠ¡: a1, a2 , a3
micro-taské˜Ÿåˆ—åŒ…å«ä»»åŠ¡: b1, b2 , b3

æ‰§è¡Œé¡ºåºä¸ºï¼Œé¦–å…ˆæ‰§è¡Œmarco-taské˜Ÿåˆ—å¼€å¤´çš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ a1 ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œåœ¨æ‰§è¡Œmicro-taské˜Ÿåˆ—é‡Œçš„æ‰€æœ‰ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ä¾æ¬¡æ‰§è¡Œb1, b2 , b3ï¼Œæ‰§è¡Œå®Œåæ¸…ç©ºmicro-taskä¸­çš„ä»»åŠ¡ï¼Œæ¥ç€æ‰§è¡Œmarco-taskä¸­çš„ç¬¬äºŒä¸ªä»»åŠ¡ï¼Œä¾æ¬¡å¾ªç¯ã€‚

å†ç®€å•ç‚¹çš„è¯ é‚£å°±.. ä¸Šå›¾å§ğŸ˜„

![jsworke](/images/jsWorker/jsworker3.jpg)s

å¥½çš„ ç†è§£çš„è¯ å†æ¥ä¸€ä¸ªæ —å­ ä½ å¯èƒ½ç»§ç»­æ‡µé€¼


```
setTimeout(function(){console.log(1)},0);

new Promise(function(resolve,reject){
   console.log(2);
   resolve();
}).then(function(){console.log(3)
}).then(function(){console.log(4)});

process.nextTick(function(){console.log(5)});

console.log(6);
è¾“å‡º 2ï¼Œ6ï¼Œ5 ï¼Œ3ï¼Œ4ï¼Œ1
```
å®šä¹‰promiseçš„æ„é€ éƒ¨åˆ†æ˜¯åŒæ­¥çš„
å¦‚ä¸‹
script(ä¸»ç¨‹åºä»£ç )â€”â€”>process.nextTickâ€”â€”>promiseâ€”â€”>setTimeout

å…³äº process.nextTick()
æ’å…¥åˆ°äº‹ä»¶é˜Ÿåˆ—å°¾éƒ¨ï¼Œä½†åœ¨ä¸‹æ¬¡äº‹ä»¶é˜Ÿåˆ—ä¹‹å‰ä¼šæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæŒ‡å®šçš„ä»»åŠ¡æ€»æ˜¯å‘ç”Ÿåœ¨æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡ä¹‹å‰ï¼Œå½“å‰ä¸»çº¿ç¨‹çš„æœ«å°¾ã€‚
å¤§è‡´æµç¨‹ï¼šå½“å‰â€æ‰§è¡Œæ ˆâ€çš„å°¾éƒ¨â€“>ä¸‹ä¸€æ¬¡Event Loopï¼ˆä¸»çº¿ç¨‹è¯»å–â€ä»»åŠ¡é˜Ÿåˆ—â€ï¼‰ä¹‹å‰â€“>è§¦å‘processæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚
æœåŠ¡å™¨ç«¯nodeæä¾›çš„åŠæ³•ã€‚ç”¨æ­¤æ–¹æ³•å¯ä»¥ç”¨äºå¤„äºå¼‚æ­¥å»¶è¿Ÿçš„é—®é¢˜ã€‚
å¯ä»¥ç†è§£ä¸ºï¼šæ­¤æ¬¡ä¸è¡Œï¼Œé¢„çº¦ä¸‹æ¬¡ä¼˜å…ˆæ‰§è¡Œã€‚

å¥½çš„ å†å†æ¥ä¸€ä¸ªğŸ˜‚


```
setTimeout(function(){console.log(1)},0); ï¼ˆsetTimeout1ï¼‰

new Promise(function(resolve,reject){
   console.log(2);  ï¼ˆpromise1ï¼‰
   setTimeout(function(){resolve()},0) ï¼ˆsetTimeout2ï¼‰
}).then(function(){console.log(3)  ï¼ˆthen1ï¼‰
}).then(function(){console.log(4)}); ï¼ˆthen2ï¼‰

process.nextTick(function(){console.log(5)}); ï¼ˆnextTickï¼‰

console.log(6); ï¼ˆlogï¼‰
è¾“å‡ºï¼š 2 6 5 1 3 4
```

åŒºåˆ«åœ¨äºpromiseçš„æ„é€ ä¸­ï¼Œæ²¡æœ‰åŒæ­¥çš„resolveï¼Œå› æ­¤promise.thenåœ¨å½“å‰çš„æ‰§è¡Œé˜Ÿåˆ—ä¸­æ˜¯ä¸å­˜åœ¨çš„ï¼Œåªæœ‰promiseä»pendingè½¬ç§»åˆ°resolveï¼Œæ‰ä¼šæœ‰thenæ–¹æ³•ï¼Œè€Œè¿™ä¸ªresolveæ˜¯åœ¨ä¸€ä¸ªsetTimoutæ—¶é—´ä¸­å®Œæˆçš„ï¼Œå› æ­¤3,4æœ€åè¾“å‡ºã€‚

å†™åˆ°è¿™é‡Œ æƒ³åˆ°ä¸€ä¸ªæŸä½å¤§å¸ˆçš„å¾ˆå½¢è±¡çš„ä¾‹å­

äº‹ä»¶å¾ªç¯é˜Ÿåˆ—å°±ç±»ä¼¼äºæ¸¸ä¹å›­æ¸¸æˆï¼Œç©è¿‡äº†ä¸€ä¸ªæ¸¸æˆä¹‹å ä½ éœ€è¦åˆ°é˜Ÿå°¾å»æ’é˜Ÿæ‰èƒ½å†ç©ä¸€æ¬¡ è€Œä»»åŠ¡é˜Ÿåˆ—ç±»ä¼¼wç©è¿‡äº†è¿™ä¸ªæ¸¸æˆä¹‹å æ’é˜Ÿæ¥ç€ç©
çœ‹åˆ°è¿™é‡Œ æ–‡ç« å¼€å¤´çš„é¢˜ç›®åº”è¯¥ä¸æˆé—®é¢˜äº† ç”šè‡³è¿˜è§‰å¾—so easy

å¥½çš„ åˆ°è¿™é‡Œ å°±å®Œäº† ä¸‹é¢æ˜¯ä¸¤ä¸ªjsè¿è¡Œæ—¶çš„æ¦‚å¿µ ä½ å¯ä»¥å‚²å¨‡çš„ç•¥è¿‡

-------
> jsæ‰§è¡Œæ—¶

jsè°ƒç”¨æ ˆ

æ‹¥æœ‰ LIFOï¼ˆåè¿›å…ˆå‡ºï¼‰æ•°æ®ç»“æ„çš„æ ˆï¼Œè¢«ç”¨æ¥å­˜å‚¨ä»£ç è¿è¡Œæ—¶åˆ›å»ºçš„æ‰€æœ‰**æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼Œè®°å½•äº†æˆ‘ä»¬åœ¨ç¨‹åºä¸­çš„ä½ç½®  å¦‚æœæˆ‘ä»¬è¿è¡Œåˆ°ä¸€ä¸ªå‡½æ•° å®ƒå°±ä¼šå°†å…¶æ”¾åˆ°æ ˆé¡¶ å½“ä»è¿™ä¸ªå‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œå°±ä¼šå°†è¿™ä¸ªå‡½æ•°ä»æ ˆé¡¶å¼¹å‡ºï¼Œè¿™å°±æ˜¯è°ƒç”¨æ ˆåšçš„äº‹æƒ…

å½“ `JavaScript` å¼•æ“ç¬¬ä¸€æ¬¡é‡åˆ°ä½ çš„è„šæœ¬æ—¶ï¼Œå®ƒä¼šåˆ›å»ºä¸€ä¸ªå…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶ä¸”å‹å…¥å½“å‰æ‰§è¡Œæ ˆã€‚æ¯å½“å¼•æ“é‡åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå®ƒä¼šä¸ºè¯¥å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ ˆçš„é¡¶éƒ¨ã€‚

å¼•æ“ä¼šæ‰§è¡Œé‚£äº›æ‰§è¡Œä¸Šä¸‹æ–‡ä½äºæ ˆé¡¶çš„å‡½æ•°ã€‚å½“è¯¥å‡½æ•°æ‰§è¡Œç»“æŸæ—¶ï¼Œæ‰§è¡Œä¸Šä¸‹æ–‡ä»æ ˆä¸­å¼¹å‡ºï¼Œæ§åˆ¶æµç¨‹åˆ°è¾¾å½“å‰æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸Šä¸‹æ–‡

-------

> jsæ‰§è¡Œä¸Šä¸‹æ–‡

æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯è¯„ä¼°å’Œæ‰§è¡Œjsä»£ç çš„ç¯å¢ƒçš„æŠ½è±¡æ¦‚å¿µ
jsä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ å®ƒéƒ½æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œ

å®ƒåˆ†ä¸ºä¸‰ç§ç±»å‹
1. å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡

```
å®ƒä¼šæ‰§è¡Œä¸¤ä»¶äº‹ï¼š åˆ›å»ºä¸€ä¸ªå…¨å±€windowå¯¹è±¡ å¹¶ä¸”è®¾ç½®thisçš„å€¼ç­‰äºè¿™ä¸ªå…¨å±€å¯¹è±¡ ä¸€ä¸ªç¨‹åºä¸­åªä¼šæœ‰ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡
```
2. å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡

```
å‡½æ•°è¢«è°ƒç”¨æ—¶å€™ ä¼šåˆ›å»ºä¸Šä¸‹æ–‡ï¼Œå‡½æ•°ä¸Šä¸‹æ–‡å¯ä»¥æœ‰ä»»æ„å¤šä¸ª  æ¯å½“ä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¢«åˆ›å»º å®ƒä¼šæŒ‰å®šä¹‰çš„é¡ºåº æ‰§è¡Œä¸€ç³»åˆ—æ­¥éª¤
```
3. evalå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡

```
æ‰§è¡Œåœ¨evalå‡½æ•°å†…éƒ¨çš„ä»£ç ä¼šæœ‰ä»–è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡
```

**jså¦‚ä½•åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡**

ä¸¤ä¸ªé˜¶æ®µ

* åˆ›å»ºé˜¶æ®µ
* æ‰§è¡Œé˜¶æ®µ


ä»£ç æ‰§è¡Œé’± æ‰§è¡Œä¸Šä¸‹æ–‡ç»å†åˆ›å»ºé˜¶æ®µ ä¼šå‘ç”Ÿ
1. thiså€¼çš„åˆ¶å®š
2. åˆ›å»ºè¯æ³•ç¯å¢ƒç»„ä»¶
3. åˆ›å»ºå˜é‡ç¯å¢ƒç»„ä»¶

-------

æœ€åçš„æœ€å

JavaScript æ˜¯å•çº¿ç¨‹è¯­è¨€ï¼Œå†³å®šäºå®ƒçš„è®¾è®¡æœ€åˆæ˜¯ç”¨æ¥å¤„ç†æµè§ˆå™¨ç½‘é¡µçš„äº¤äº’ã€‚æµè§ˆå™¨è´Ÿè´£è§£é‡Šå’Œæ‰§è¡Œ JavaScript çš„çº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼ˆæ‰€ä»¥è¯´æ˜¯å•çº¿ç¨‹ï¼‰ï¼Œå³JSå¼•æ“çº¿ç¨‹ï¼Œä½†æ˜¯æµè§ˆå™¨åŒæ ·æä¾›å…¶ä»–çº¿ç¨‹ï¼Œå¦‚ï¼šäº‹ä»¶è§¦å‘çº¿ç¨‹ã€å®šæ—¶å™¨è§¦å‘çº¿ç¨‹ç­‰

æ¥ä¸ªå¤æ‚ç‚¹çš„é¢˜ç›® å¦‚æœä½ è§‰å¾—æœ‰å›°éš¾ é‚£å°±ç¿»ä¸Šå»å†çœ‹ä¸€é¢æ–‡ç« å§ ä¸€å®šèƒ½æ‰¾åˆ°ç­”æ¡ˆ

```
process.nextTick(()=>{
    console.log('process 1')
})

setTimeout(()=>{
    console.log('setTimeout 1')
    process.nextTick(()=>{
        console.log('process 2')
        setTimeout(()=>{
            console.log('setTimeout 4')
        })
    })
})

setTimeout(()=>{
    console.log('setTimeout 2')
    process.nextTick(()=>{
        console.log('process 4')
        setTimeout(()=>{
            console.log('setTimeout 5')
        })
    })
})

setTimeout(()=>{
    console.log('setTimeout 3')
})

process.nextTick(()=>{
    console.log('process 3')
})

// ç»“æœï¼š
process 1
process 3
setTimeout 1
setTimeout 2
setTimeout 3
process 2
process 4
setTimeout 4
setTimeout 5
```












